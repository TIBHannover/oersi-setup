---

- name: Find fpm-socket
  find:
    paths: /var/run/php
    patterns: '*fpm.sock'
    file_type: any
  register: fpm_socket_find_result
      
- name: Configure nginx.
  become: true
  template:
    src: nginx.conf.j2
    dest: /etc/nginx/sites-available/matomo.conf
  vars:
    fpm_socket: '{{ fpm_socket_find_result.files[0].path }}'
  notify:
    - restart nginx

- name: enable nginx config
  become: true
  file:
    path: '/etc/nginx/sites-enabled/matomo.conf'
    src: '/etc/nginx/sites-available/matomo.conf'
    state: link
  notify:
    - restart nginx
