#!/bin/bash
# {{ ansible_managed }}
#
# Show versions of oersi modules
#

echo "---"
echo "ETL"
echo "---"
cat {{ oerindex_etl_downloaddir }}/build.info
ETL_COMMIT_SHA=$(grep "COMMIT_SHA=" {{ oerindex_etl_downloaddir }}/build.info | cut -d'=' -f2)
ETL_BUILDNUMBER=$(grep "BUILDNUMBER=" {{ oerindex_etl_downloaddir }}/build.info | cut -d'=' -f2)
echo "SOURCE: https://gitlab.com/oersi/oersi-etl/-/tree/${ETL_COMMIT_SHA}"
echo "BUILD-JOB: https://gitlab.com/oersi/oersi-etl/-/jobs/${ETL_BUILDNUMBER}"

echo "--------------"
echo "Import Scripts"
echo "--------------"
cat {{ oerindex_import_scripts_dir }}/build.info
IMPORTSCRIPTS_COMMIT_SHA=$(grep "COMMIT_SHA=" {{ oerindex_import_scripts_dir }}/build.info | cut -d'=' -f2)
IMPORTSCRIPTS_BUILDNUMBER=$(grep "BUILDNUMBER=" {{ oerindex_import_scripts_dir }}/build.info | cut -d'=' -f2)
echo "SOURCE: https://gitlab.com/oersi/oersi-import-scripts/-/tree/${IMPORTSCRIPTS_COMMIT_SHA}"
echo "BUILD-JOB: https://gitlab.com/oersi/oersi-import-scripts/-/jobs/${IMPORTSCRIPTS_BUILDNUMBER}"

echo "-------"
echo "Backend"
echo "-------"
cat {{ tomcat_home }}/webapps/oersi/WEB-INF/classes/build.info
BACKEND_COMMIT_SHA=$(grep "COMMIT_SHA=" {{ tomcat_home }}/webapps/oersi/WEB-INF/classes/build.info | cut -d'=' -f2)
BACKEND_BUILDNUMBER=$(grep "BUILDNUMBER=" {{ tomcat_home }}/webapps/oersi/WEB-INF/classes/build.info | cut -d'=' -f2)
echo "SOURCE: https://gitlab.com/oersi/oersi-backend/-/tree/${BACKEND_COMMIT_SHA}"
echo "BUILD-JOB: https://gitlab.com/oersi/oersi-backend/-/jobs/${BACKEND_BUILDNUMBER}"

echo "--------"
echo "Frontend"
echo "--------"
cat {{ oerindex_frontend_instdir }}/build.info
FRONTEND_COMMIT_SHA=$(grep "COMMIT_SHA=" {{ oerindex_frontend_instdir }}/build.info | cut -d'=' -f2)
FRONTEND_BUILDNUMBER=$(grep "BUILDNUMBER=" {{ oerindex_frontend_instdir }}/build.info | cut -d'=' -f2)
echo "SOURCE: https://gitlab.com/oersi/oersi-frontend/-/tree/${FRONTEND_COMMIT_SHA}"
echo "BUILD-JOB: https://gitlab.com/oersi/oersi-frontend/-/jobs/${FRONTEND_BUILDNUMBER}"
